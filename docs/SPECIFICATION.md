# Roostr MVP Feature Specification
## "Your Private Roost on Nostr"
### Detailed Requirements for Launch

**Version:** 1.0 Draft  
**Last Updated:** December 13, 2025

---

## Table of Contents

1. [First-Run Setup Wizard](#1-first-run-setup-wizard)
2. [Dashboard](#2-dashboard)
3. [Statistics & Metrics](#3-statistics--metrics)
4. [Access Control (Whitelist/Blacklist)](#4-access-control-whitelistblacklist)
5. [Event Browser](#5-event-browser)
6. [Relay Configuration](#6-relay-configuration)
7. [Storage Management](#7-storage-management)
8. [Export & Backup](#8-export--backup)
9. [Support & Donations](#9-support--donations)
10. [Sync from Public Relays](#10-sync-from-public-relays)
11. [Paid Relay Access](#11-paid-relay-access)
12. [Tor & Network Infrastructure](#12-tor--network-infrastructure)
13. [Platform Integration](#13-platform-integration)
14. [Global UI/UX Requirements](#14-global-uiux-requirements)
15. [API Specification](#15-api-specification)
16. [Data Models](#16-data-models)

---

## 1. First-Run Setup Wizard

When a user first installs Roostr, they need guided setup to get their relay configured and working. This wizard runs once on first launch.

### 1.1 User Stories

- **As a new user**, I want a guided setup so I don't have to figure out configuration myself
- **As a new user**, I want to be automatically whitelisted on my own relay
- **As a new user**, I want sensible defaults so my relay is secure from the start
- **As a new user**, I want to understand what my relay URL is and how to use it

### 1.2 Setup Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                     â”‚
â”‚                         ğŸ“ Welcome to Roostr                        â”‚
â”‚                      Your Private Roost on Nostr                   â”‚
â”‚                                                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                     â”‚
â”‚  Let's get your private relay set up. This will only take a        â”‚
â”‚  minute.                                                            â”‚
â”‚                                                                     â”‚
â”‚                         [ Get Started â†’ ]                           â”‚
â”‚                                                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                     â”‚
â”‚  Step 1 of 5                                                        â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 Step-by-Step Screens

#### Step 1: Your Identity

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 1 of 5: Your Identity                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  Enter your Nostr public key (npub) or NIP-05 identifier.          â”‚
â”‚  You'll be automatically whitelisted as the relay operator.        â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ npub1... or you@domain.com                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  âœ“ Valid pubkey: npub1abc...xyz                                    â”‚
â”‚  âœ“ Profile found: @yourname                                        â”‚
â”‚                                                                     â”‚
â”‚  â“˜ This pubkey will have full access to your relay and cannot     â”‚
â”‚    be removed without resetting Roostr.                            â”‚
â”‚                                                                     â”‚
â”‚                                          [â† Back]  [Continue â†’]    â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Step 2: Name Your Relay

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 2 of 5: Name Your Relay                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  Give your relay a name and description. This is shown to          â”‚
â”‚  clients that connect.                                              â”‚
â”‚                                                                     â”‚
â”‚  Relay Name:                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Ryan's Private Relay                                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  Description:                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Personal backup relay for family and friends.               â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  Contact (optional):                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ npub1abc... (auto-filled from Step 1)                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚                                          [â† Back]  [Continue â†’]    â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Step 3: Access Mode

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 3 of 5: Who Can Use Your Relay?                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  Choose who can write events to your relay.                        â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  â— Private (Recommended)                                    â”‚   â”‚
â”‚  â”‚    Only you and people you whitelist can write.             â”‚   â”‚
â”‚  â”‚    Best for personal backup and family use.                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  â—‹ Paid Access                                              â”‚   â”‚
â”‚  â”‚    Whitelist + anyone who pays via Lightning.               â”‚   â”‚
â”‚  â”‚    Requires Lightning node setup (can configure later).     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  â—‹ Public                                                   â”‚   â”‚
â”‚  â”‚    Anyone can write. Not recommended for home servers.      â”‚   â”‚
â”‚  â”‚    May fill your disk quickly with spam.                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚                                          [â† Back]  [Continue â†’]    â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Step 4: Add Family/Friends (Optional)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 4 of 5: Add Others (Optional)                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  Want to whitelist anyone else right now? You can always add       â”‚
â”‚  more people later.                                                 â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ npub or NIP-05                                    [+ Add]   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  Whitelisted:                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  âœ“ You (npub1abc...xyz) - Operator                    [âœ•]  â”‚   â”‚
â”‚  â”‚  âœ“ npub1wife... - Wife                                [âœ•]  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  ğŸ’¡ Tip: Your whitelisted users should add your relay URL to      â”‚
â”‚     their Nostr client to start backing up their events.           â”‚
â”‚                                                                     â”‚
â”‚                                 [Skip for now]  [Continue â†’]       â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Step 5: Complete!

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ‰ You're All Set!                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  Your private relay is ready to use.                               â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  YOUR RELAY URLS                                             â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  Local Network:                                              â”‚   â”‚
â”‚  â”‚  ws://192.168.1.100:4848                      [Copy] [QR]   â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  Tor (Remote Access):                                        â”‚   â”‚
â”‚  â”‚  ws://abc123...onion:4848                     [Copy] [QR]   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  NEXT STEPS                                                  â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  1. Add your relay URL to your Nostr client                 â”‚   â”‚
â”‚  â”‚     (Damus: Settings â†’ Relays â†’ Add Relay)                  â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  2. Sync your existing posts from public relays             â”‚   â”‚
â”‚  â”‚     (Click the Sync button on the dashboard)                â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  3. Share your Tor URL with whitelisted friends             â”‚   â”‚
â”‚  â”‚     so they can connect remotely                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚                                       [ Go to Dashboard â†’ ]        â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.4 Setup Data Model

```sql
-- Track setup completion and operator
CREATE TABLE app_state (
    key TEXT PRIMARY KEY,
    value TEXT NOT NULL,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Initial values set during setup:
-- setup_complete: "true" / "false"
-- operator_pubkey: "hexkey..."
-- operator_npub: "npub1..."
-- setup_completed_at: "2025-12-13T..."
```

### 1.5 Skip/Reset Setup

- If `setup_complete = false`, redirect all routes to setup wizard
- Provide a "Reset Roostr" option in settings (clears app_state, keeps relay data)
- Resetting requires confirmation and re-runs setup wizard

---

## 2. Dashboard

The dashboard is the home screen - the first thing users see after completing setup. It should immediately communicate the health and status of their relay while providing quick access to key actions.

### 10.1 User Stories

- **As a user**, I want to see at a glance if my relay is running and healthy
- **As a user**, I want to see my relay's connection URL so I can add it to my Nostr clients
- **As a user**, I want to know how much data my relay is storing
- **As a user**, I want to see recent activity on my relay
- **As a user**, I want quick access to common actions without navigating through menus

### 2.2 Dashboard Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“ Roostr                              [ğŸ”„ Sync] [âš™ï¸] [Support]    â”‚
â”‚  "Your private roost on Nostr"                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  RELAY STATUS                                                â”‚   â”‚
â”‚  â”‚  â— Online                          Uptime: 14d 6h 23m       â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  WebSocket URL:  ws://umbrel.local:4848     [Copy] [QR]     â”‚   â”‚
â”‚  â”‚  Tor URL:        ws://abc123...onion:4848   [Copy] [QR]     â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  Last synced: 2 hours ago                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  TOTAL EVENTS    â”‚ â”‚  STORAGE USED    â”‚ â”‚  PUBKEYS         â”‚   â”‚
â”‚  â”‚     12,847       â”‚ â”‚    247 MB        â”‚ â”‚     3            â”‚   â”‚
â”‚  â”‚  â†‘ 142 today     â”‚ â”‚  of 10 GB        â”‚ â”‚  whitelisted     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  POSTS           â”‚ â”‚  REACTIONS       â”‚ â”‚  DMs             â”‚   â”‚
â”‚  â”‚     8,234        â”‚ â”‚     2,312        â”‚ â”‚      892         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  RECENT ACTIVITY                                    [View All]â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚   â”‚
â”‚  â”‚  â–¶ Post received        npub1abc...        2 min ago     â†’  â”‚   â”‚
â”‚  â”‚  â–¶ Reaction received    npub1def...        5 min ago     â†’  â”‚   â”‚
â”‚  â”‚  â–¶ Post received        npub1abc...        12 min ago    â†’  â”‚   â”‚
â”‚  â”‚  â–¶ Connection           npub1xyz...        23 min ago       â”‚   â”‚
â”‚  â”‚  â–¶ Follow list updated  npub1abc...        1 hour ago    â†’  â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  (Click any row to view event details in Event Browser)     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  QUICK ACTIONS                                               â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  [+ Add to Whitelist]  [Browse Events]  [Export Backup]     â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 Component Specifications

#### Relay Status Card
| Element | Description |
|---------|-------------|
| Status Indicator | Green dot = online, Red dot = offline, Yellow = degraded |
| Uptime | Time since last restart, format: Xd Xh Xm |
| WebSocket URL | Local network URL with copy button and QR code generator |
| Tor URL | .onion address (if available) with copy button and QR code |
| Last Synced | Timestamp of last sync operation (links to sync feature) |

#### Tor URL Detection
The Tor URL is provided by the host platform (Umbrel/Start9) and enables remote access to the relay without port forwarding or exposing your home IP:

| Platform | Tor URL Source |
|----------|----------------|
| Umbrel | Read from `TOR_ADDRESS` environment variable or `~/umbrel/tor/data/app-{app-id}/hostname` |
| Start9 | Provided via StartOS properties system, read from `TOR_ADDRESS` env var |

- If Tor is not available/configured, the Tor URL row is hidden
- Tor URLs use format: `ws://{onion-address}:4848` (note: `ws://` not `wss://` over Tor)
- QR codes should encode the full WebSocket URL for easy mobile scanning

#### Metric Cards (Top Row)
| Metric | Source | Update Frequency |
|--------|--------|------------------|
| Total Events | `SELECT COUNT(*) FROM event` | Every 30 seconds |
| Storage Used | Database file size + any media | Every 60 seconds |
| Whitelisted Pubkeys | Count from config.toml whitelist | On config change |

#### Event Type Cards (Second Row)

Using human-friendly labels (learned from existing Umbrel app):

| Label | Kind(s) | Description | Query |
|-------|---------|-------------|-------|
| Posts | 1 | Short text notes | `SELECT COUNT(*) FROM event WHERE kind = 1` |
| Reactions | 7 | Likes/reactions | `SELECT COUNT(*) FROM event WHERE kind = 7` |
| DMs | 4, 14 | Direct messages | `SELECT COUNT(*) FROM event WHERE kind IN (4, 14)` |
| Reposts | 6 | Reposts/boosts | `SELECT COUNT(*) FROM event WHERE kind = 6` |
| Follows | 3 | Follow lists | `SELECT COUNT(*) FROM event WHERE kind = 3` |
| Other | * | Everything else | Remaining events |

#### Recent Activity Feed
- Shows last 10 events/connections
- Real-time updates via WebSocket subscription to relay
- Each entry shows: event type icon, kind label, author npub (truncated), relative time
- **Clickable rows**: Clicking an activity item navigates to Event Browser with that event pre-selected/highlighted
- "View All" links to Event Browser (unfiltered)
- Link format: `/events?id={event_id}` or `/events?highlight={event_id}`

#### Quick Actions
- **Add to Whitelist**: Opens modal to add pubkey
- **Browse Events**: Navigates to Event Browser
- **Export Backup**: Opens export dialog

### 2.4 Technical Requirements

- Dashboard data should load within 2 seconds
- Metric cards should update without full page refresh
- QR codes generated client-side (no external service)
- URLs should be one-click copyable with visual feedback
- Mobile: Stack cards vertically, maintain tap targets

---

## 3. Statistics & Metrics

Detailed statistics beyond the dashboard overview, providing insight into relay usage patterns.

### 10.1 User Stories

- **As a user**, I want to see how my relay usage changes over time
- **As a user**, I want to know which event types are most common
- **As a user**, I want to see which pubkeys are most active on my relay
- **As a user**, I want to understand my storage breakdown

### 4.2 Statistics Page Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Statistics                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  Time Range: [Today] [7 Days] [30 Days] [All Time]                 â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  EVENTS OVER TIME                                            â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  800 â”¤                                    â•­â”€â•®                â”‚   â”‚
â”‚  â”‚  600 â”¤              â•­â”€â”€â•®    â•­â”€â•®          â”‚ â”‚   â•­â•®           â”‚   â”‚
â”‚  â”‚  400 â”¤    â•­â”€â•®      â”‚  â”‚â•­â”€â”€â•®â”‚ â”‚    â•­â”€â•®   â”‚ â”‚  â•­â•¯â•°â•®          â”‚   â”‚
â”‚  â”‚  200 â”¤â•­â”€â”€â•®â”‚ â”‚â•­â”€â”€â”€â”€â•®â”‚  â”‚â”‚  â”‚â”‚ â”‚â•­â”€â”€â•®â”‚ â”‚â•­â”€â•®â”‚ â”‚â•­â”€â•¯  â”‚          â”‚   â”‚
â”‚  â”‚    0 â”¼â”´â”€â”€â”´â”´â”€â”´â”´â”€â”€â”€â”€â”´â”´â”€â”€â”´â”´â”€â”€â”´â”´â”€â”´â”´â”€â”€â”´â”´â”€â”´â”´â”€â”´â”´â”€â”´â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€    â”‚   â”‚
â”‚  â”‚       Mon  Tue  Wed  Thu  Fri  Sat  Sun                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  EVENTS BY KIND           â”‚ â”‚  TOP AUTHORS                  â”‚   â”‚
â”‚  â”‚                           â”‚ â”‚                               â”‚   â”‚
â”‚  â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ kind 1    â”‚ â”‚  npub1abc...  4,281 events   â”‚   â”‚
â”‚  â”‚  64% (8,234)              â”‚ â”‚  npub1def...  2,847 events   â”‚   â”‚
â”‚  â”‚                           â”‚ â”‚  npub1ghi...  1,203 events   â”‚   â”‚
â”‚  â”‚  â–ˆâ–ˆâ–ˆâ–ˆ kind 7              â”‚ â”‚                               â”‚   â”‚
â”‚  â”‚  18% (2,312)              â”‚ â”‚                               â”‚   â”‚
â”‚  â”‚                           â”‚ â”‚                               â”‚   â”‚
â”‚  â”‚  â–ˆâ–ˆ kind 4/14             â”‚ â”‚                               â”‚   â”‚
â”‚  â”‚  7% (892)                 â”‚ â”‚                               â”‚   â”‚
â”‚  â”‚                           â”‚ â”‚                               â”‚   â”‚
â”‚  â”‚  â–ˆ Other                  â”‚ â”‚                               â”‚   â”‚
â”‚  â”‚  11% (1,409)              â”‚ â”‚                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  STORAGE BREAKDOWN                                           â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  Database:     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘  234 MB (94%)      â”‚   â”‚
â”‚  â”‚  Indexes:      â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘   13 MB  (5%)      â”‚   â”‚
â”‚  â”‚  Other:        â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘    2 MB  (1%)      â”‚   â”‚
â”‚  â”‚                                            â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”‚   â”‚
â”‚  â”‚                                Total:       249 MB           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 Metrics to Track

| Metric | Description | Query/Source |
|--------|-------------|--------------|
| Events per day | Count grouped by date | `GROUP BY date(created_at)` |
| Events by kind | Distribution of event types | `GROUP BY kind` |
| Top authors | Most active pubkeys | `GROUP BY pubkey ORDER BY COUNT(*) DESC` |
| Storage size | Total database size | File system stat |
| Avg event size | Mean event content length | `AVG(LENGTH(content))` |
| Events today | Today's event count | `WHERE date(created_at) = date('now')` |

### 4.4 Chart Specifications

- **Events Over Time**: Line chart, responsive, shows trend
- **Events by Kind**: Horizontal bar chart or pie chart
- **Top Authors**: Simple ranked list with counts
- **Storage Breakdown**: Stacked bar or simple progress bars

---

## 4. Access Control (Whitelist/Blacklist)

The core "private relay" functionality - controlling who can write to your relay.

### 10.1 User Stories

- **As a user**, I want to restrict my relay to only accept events from specific pubkeys
- **As a user**, I want to add pubkeys by pasting them or by NIP-05 identifier
- **As a user**, I want to see all allowed/blocked pubkeys in one place
- **As a user**, I want to remove pubkeys from the whitelist/blacklist
- **As a user**, I want to add multiple pubkeys at once (bulk import)
- **As a user**, I want to give nicknames to pubkeys so I remember who they are

### 4.2 Access Control Page Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Access Control                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  MODE                                                        â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  â—‹ Open (anyone can write)                                  â”‚   â”‚
â”‚  â”‚  â— Whitelist (only allowed pubkeys can write)  [ACTIVE]     â”‚   â”‚
â”‚  â”‚  â—‹ Paid (whitelist + paid subscribers)                      â”‚   â”‚
â”‚  â”‚  â—‹ Blacklist (block specific pubkeys)                       â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  â“˜ Changes take effect immediately                          â”‚   â”‚
â”‚  â”‚  â“˜ For Paid mode settings, see [Paid Access] section        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  WHITELISTED PUBKEYS (3)                        [+ Add New] â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚ ğŸ‘¤ Me (primary)                                      â”‚    â”‚   â”‚
â”‚  â”‚  â”‚    npub1qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqs9wrq3g    â”‚    â”‚   â”‚
â”‚  â”‚  â”‚    Added: Dec 10, 2025    Events: 4,281              â”‚    â”‚   â”‚
â”‚  â”‚  â”‚                                          [Edit] [âœ•]  â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚ ğŸ‘¤ Wife                                              â”‚    â”‚   â”‚
â”‚  â”‚  â”‚    npub1aaaabbbbccccddddeeeeffffgggghhhhiiiijjjjkkkk â”‚    â”‚   â”‚
â”‚  â”‚  â”‚    Added: Dec 11, 2025    Events: 847                â”‚    â”‚   â”‚
â”‚  â”‚  â”‚                                          [Edit] [âœ•]  â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚ ğŸ‘¤ alice@nostr.me                                    â”‚    â”‚   â”‚
â”‚  â”‚  â”‚    npub1xyzxyzxyzxyzxyzxyzxyzxyzxyzxyzxyzxyzxyzxyzxy â”‚    â”‚   â”‚
â”‚  â”‚  â”‚    Added: Dec 12, 2025    Events: 0                  â”‚    â”‚   â”‚
â”‚  â”‚  â”‚                                          [Edit] [âœ•]  â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  [Import from File]  [Export List]                                 â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 Add Pubkey Modal

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Add to Whitelist                                          [âœ•] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Pubkey or NIP-05 identifier:                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ npub1... or user@domain.com                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  Nickname (optional):                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ e.g., "Brother", "Work colleague"                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ âœ“ Validated: npub1abc...xyz                             â”‚   â”‚
â”‚  â”‚   Profile found: @alice (Alice Smith)                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚                                    [Cancel]  [Add to Whitelist] â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.4 Functional Requirements

| Feature | Description |
|---------|-------------|
| **Mode Selection** | Radio buttons for Open/Whitelist/Paid/Blacklist mode |
| **Add Single Pubkey** | Accept npub, hex, or NIP-05 identifier |
| **NIP-05 Resolution** | Lookup pubkey from user@domain.com format |
| **Pubkey Validation** | Validate format before adding |
| **Profile Lookup** | Optionally fetch profile metadata for display |
| **Nicknames** | User-assigned labels stored locally |
| **Bulk Import** | Upload .txt or .json file with multiple pubkeys |
| **Export List** | Download current list as .json |
| **Event Count** | Show number of events from each pubkey |
| **Remove Confirmation** | Confirm before removing from list |
| **Immediate Effect** | Changes apply without relay restart |
| **Paid Mode Link** | Quick link to Paid Access settings (Section 9) |

### 4.5 NIP-05 Resolution Flow

```
User enters: alice@nostr.me
     â”‚
     â–¼
Fetch: https://nostr.me/.well-known/nostr.json?name=alice
     â”‚
     â–¼
Parse JSON: { "names": { "alice": "<hex-pubkey>" } }
     â”‚
     â–¼
Convert hex to npub for display
     â”‚
     â–¼
Show profile info if available (kind:0 lookup)
```

### 4.6 Config.toml Integration

The access control settings map to nostr-rs-relay's config:

```toml
[authorization]
# Mode: "open", "whitelist", "paid", or "blacklist"
# We manage this via our API
# Note: "paid" mode uses whitelist + paid_users from Roostr's database

# For whitelist mode (and paid mode base list):
pubkey_whitelist = [
  "hexkey1",  # Manual whitelist (family)
  "hexkey2",  # Paid user (added automatically)
  "hexkey3"   # Paid user (added automatically)
]

# For blacklist mode:
pubkey_blacklist = [
  "badhexkey1"
]
```

**API must:**
1. Read current config.toml
2. Modify the relevant section
3. Write back to config.toml
4. Signal relay to reload config (or restart if necessary)

---

## 5. Event Browser

Browse, search, and inspect all events stored on the relay.

### 10.1 User Stories

- **As a user**, I want to see all events stored on my relay
- **As a user**, I want to filter events by type (kind), author, or date
- **As a user**, I want to see the full details of any event
- **As a user**, I want to find events where I'm mentioned
- **As a user**, I want to delete specific events from my relay

### 5.2 Event Browser Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Event Browser                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  FILTERS                                                     â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  Kind: [All Kinds     â–¼]    Author: [All Authors    â–¼]      â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  Date Range: [Start Date  ] to [End Date    ]  [Apply]      â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  â–¡ Only show events mentioning me                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  Showing 1-50 of 12,847 events                    [â† Prev] [Next â†’]â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  NOTE (kind 1)                              Dec 13, 2:34 PM â”‚   â”‚
â”‚  â”‚  npub1abc...xyz (@alice)                                    â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚  â”‚  Just set up my private relay on Umbrel! This is amazing    â”‚   â”‚
â”‚  â”‚  for keeping my notes backed up. #nostr #sovereignty        â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚                                        [View Raw] [Delete]  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  REACTION (kind 7)                          Dec 13, 2:31 PM â”‚   â”‚
â”‚  â”‚  npub1def...uvw (@bob)                                      â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚  â”‚  ğŸ‘ Reacted to event note1xyz...                            â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚                                        [View Raw] [Delete]  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  FOLLOW LIST (kind 3)                       Dec 13, 1:15 PM â”‚   â”‚
â”‚  â”‚  npub1abc...xyz (@alice)                                    â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚  â”‚  Following 142 accounts                                     â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚                                        [View Raw] [Delete]  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  ... more events ...                                               â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 Event Detail Modal (View Raw)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Event Details                                             [âœ•] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Event ID:  note1abc123...                          [Copy]     â”‚
â”‚  Author:    npub1xyz789...                          [Copy]     â”‚
â”‚  Kind:      1 (Short Text Note)                                â”‚
â”‚  Created:   Dec 13, 2025 2:34:15 PM (1702489455)              â”‚
â”‚                                                                 â”‚
â”‚  Content:                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Just set up my private relay on Umbrel! This is amazing â”‚   â”‚
â”‚  â”‚ for keeping my notes backed up. #nostr #sovereignty     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  Tags:                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ["t", "nostr"]                                          â”‚   â”‚
â”‚  â”‚ ["t", "sovereignty"]                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  Raw JSON:                                         [Copy JSON] â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ {                                                       â”‚   â”‚
â”‚  â”‚   "id": "abc123...",                                    â”‚   â”‚
â”‚  â”‚   "pubkey": "xyz789...",                                â”‚   â”‚
â”‚  â”‚   "created_at": 1702489455,                             â”‚   â”‚
â”‚  â”‚   "kind": 1,                                            â”‚   â”‚
â”‚  â”‚   "tags": [["t", "nostr"], ["t", "sovereignty"]],      â”‚   â”‚
â”‚  â”‚   "content": "Just set up my private relay...",         â”‚   â”‚
â”‚  â”‚   "sig": "..."                                          â”‚   â”‚
â”‚  â”‚ }                                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚                                           [Delete Event] [Close]â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.4 Filter Options

| Filter | Options | Implementation |
|--------|---------|----------------|
| **Kind** | All, Notes (1), Reactions (7), Follows (3), DMs (4,14), Metadata (0), Custom | `WHERE kind = ?` or `WHERE kind IN (?)` |
| **Author** | All, or select from known pubkeys | `WHERE pubkey = ?` |
| **Date Range** | Start date, End date | `WHERE created_at BETWEEN ? AND ?` |
| **Mentions Me** | Checkbox | `WHERE tags LIKE '%["p","mypubkey"]%'` |

### 5.5 Event Kind Display Templates

Each event kind should render appropriately:

| Kind | Display |
|------|---------|
| 0 (Metadata) | "Profile update" + name if parseable |
| 1 (Note) | Full content text, truncated at 280 chars in list |
| 3 (Follows) | "Following X accounts" |
| 4 (DM - deprecated) | "Encrypted DM" (don't show content) |
| 7 (Reaction) | Emoji + "Reacted to [event ref]" |
| 14 (DM - NIP-17) | "Private message" (don't show content) |
| Other | "Event kind X" + raw preview |

### 5.6 Pagination

- Default page size: 50 events
- Cursor-based pagination using `created_at` timestamp
- "Load More" or traditional prev/next buttons

---

## 6. Relay Configuration

Edit relay metadata and operational settings.

### 10.1 User Stories

- **As a user**, I want to set my relay's name and description
- **As a user**, I want to configure my relay's contact info
- **As a user**, I want to set rate limits to prevent abuse
- **As a user**, I want to configure which event kinds my relay accepts

### 6.2 Configuration Page Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Relay Configuration                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  RELAY IDENTITY (NIP-11)                                     â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  Name:                                                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚ Ryan's Private Relay                                â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  Description:                                                â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚ Personal backup relay for my Nostr activity.        â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ Whitelist only.                                     â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  Contact (email or npub):                                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚ npub1mykey...                                       â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  Icon URL (optional):                                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚ https://example.com/relay-icon.png                  â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  LIMITS                                                      â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  Max event size:          [131072    ] bytes                â”‚   â”‚
â”‚  â”‚  Max WebSocket message:   [131072    ] bytes                â”‚   â”‚
â”‚  â”‚  Messages per second:     [3         ] per IP               â”‚   â”‚
â”‚  â”‚  Max subscriptions:       [10        ] per connection       â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  EVENT POLICIES                                              â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  Accepted event kinds:                                      â”‚   â”‚
â”‚  â”‚  â—‹ All kinds                                                â”‚   â”‚
â”‚  â”‚  â— Specific kinds only: [0,1,3,4,5,6,7,14,10002         ]  â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  â–¡ Require NIP-42 authentication for writes                 â”‚   â”‚
â”‚  â”‚  â–¡ Require proof of work (difficulty: [16] bits)            â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚                                             [Reset Defaults] [Save] â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.3 Configuration Fields

| Field | Config Key | Type | Default |
|-------|------------|------|---------|
| Name | `info.name` | string | "nostr-rs-relay" |
| Description | `info.description` | string | "" |
| Contact | `info.contact` | string | "" |
| Icon | `info.relay_icon` | URL string | "" |
| Max event size | `limits.max_event_bytes` | integer | 131072 |
| Max WS message | `limits.max_ws_message_bytes` | integer | 131072 |
| Messages/sec | `limits.messages_per_sec` | integer | 3 |
| Max subscriptions | `limits.max_subs_per_conn` | integer | 10 |
| Require auth | `authorization.nip42_auth` | boolean | false |
| PoW difficulty | `limits.min_pow_difficulty` | integer | 0 |

### 6.4 Save Flow

1. User modifies fields
2. Frontend validates input
3. API receives changes as JSON
4. API reads current config.toml
5. API merges changes
6. API writes new config.toml
7. API signals relay to reload (SIGHUP) or flags for restart
8. Frontend shows success/failure message

---

## 7. Storage Management

Monitor disk usage and manage data retention to prevent storage issues.

### 11.1 User Stories

- **As a user**, I want to see how much disk space my relay is using
- **As a user**, I want to be warned before my disk fills up
- **As a user**, I want to set automatic cleanup rules for old events
- **As a user**, I want to manually delete events before a certain date
- **As a user**, I want to honor deletion requests from users (NIP-09)

### 7.2 Storage Dashboard Card

Added to main dashboard:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STORAGE                                                      â”‚
â”‚                                                               â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  247 MB / 500 MB  (49%)     â”‚
â”‚                                                               â”‚
â”‚  â“˜ Healthy - plenty of space available                       â”‚
â”‚                                           [Manage Storage]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

Warning states:
- **< 80%**: Green, "Healthy"
- **80-90%**: Yellow, "Storage filling up"
- **90-95%**: Orange, "Low storage - consider cleanup"
- **> 95%**: Red, "Critical - relay may stop accepting events"

### 7.3 Storage Management Page

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Storage Management                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  CURRENT USAGE                                               â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  247 MB / 500 MB  (49%)    â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  Database:        234 MB   (events, indexes)                â”‚   â”‚
â”‚  â”‚  Application:      13 MB   (Roostr data, logs)              â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                   â”‚   â”‚
â”‚  â”‚  Total:           247 MB                                    â”‚   â”‚
â”‚  â”‚  Available:       253 MB                                    â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  Estimated runway: ~6 months at current rate                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  RETENTION POLICY                                            â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  Auto-delete events older than:                             â”‚   â”‚
â”‚  â”‚  â—‹ Never (keep forever)                                     â”‚   â”‚
â”‚  â”‚  â—‹ 1 year                                                   â”‚   â”‚
â”‚  â”‚  â—‹ 6 months                                                 â”‚   â”‚
â”‚  â”‚  â— 90 days                                                  â”‚   â”‚
â”‚  â”‚  â—‹ 30 days                                                  â”‚   â”‚
â”‚  â”‚  â—‹ Custom: [    ] days                                      â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  Exceptions (never auto-delete):                            â”‚   â”‚
â”‚  â”‚  â˜‘ My events (operator pubkey)                              â”‚   â”‚
â”‚  â”‚  â˜‘ Profile metadata (kind 0)                                â”‚   â”‚
â”‚  â”‚  â˜‘ Follow lists (kind 3)                                    â”‚   â”‚
â”‚  â”‚  â˜ DMs (kind 4, 14)                                         â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  â“˜ Retention policy runs daily at midnight                  â”‚   â”‚
â”‚  â”‚                                                   [Save]    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  NIP-09 DELETION REQUESTS                                    â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  Honor deletion requests from event authors:                â”‚   â”‚
â”‚  â”‚  â— Yes - delete events when author requests (recommended)   â”‚   â”‚
â”‚  â”‚  â—‹ No - keep all events regardless of deletion requests     â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  Pending deletion requests: 3                   [Review]    â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  â“˜ NIP-09 allows users to request deletion of their own     â”‚   â”‚
â”‚  â”‚    events. Honoring these requests is good relay etiquette. â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  MANUAL CLEANUP                                              â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  Delete all events before: [2024-01-01    ]                 â”‚   â”‚
â”‚  â”‚  Estimated events to delete: 2,847                          â”‚   â”‚
â”‚  â”‚  Estimated space freed: ~45 MB                              â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  âš ï¸ This cannot be undone. Consider exporting first.        â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚                                     [Delete Old Events]     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  DATABASE MAINTENANCE                                        â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  Last VACUUM: 3 days ago                                    â”‚   â”‚
â”‚  â”‚  Last integrity check: 7 days ago (passed âœ“)                â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  [Run VACUUM]  [Check Integrity]                            â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  â“˜ VACUUM reclaims disk space after deletions.              â”‚   â”‚
â”‚  â”‚    May take a few minutes for large databases.              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.4 NIP-09 Deletion Request Handling

When a kind 5 (deletion) event is received:

```go
type DeletionRequest struct {
    EventID     string    // The event requesting deletion
    AuthorPubkey string   // Who's requesting
    TargetIDs   []string  // Events to delete (from "e" tags)
    CreatedAt   time.Time
    Status      string    // "pending", "honored", "rejected"
}

func ProcessDeletionRequest(event Event) {
    // Only honor deletions from the original author
    for _, targetID := range event.GetETags() {
        targetEvent := db.GetEvent(targetID)
        if targetEvent.Pubkey == event.Pubkey {
            // Author matches - honor the deletion
            if config.HonorNIP09Deletions {
                db.DeleteEvent(targetID)
                logDeletion(targetID, "honored")
            } else {
                logDeletion(targetID, "ignored_by_policy")
            }
        } else {
            // Someone trying to delete another's event - reject
            logDeletion(targetID, "rejected_not_author")
        }
    }
}
```

### 7.5 Storage Alerts

When storage thresholds are crossed, show alerts:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš ï¸ Storage Warning                                        [âœ•]  â”‚
â”‚                                                                 â”‚
â”‚  Your relay storage is 87% full (435 MB / 500 MB).             â”‚
â”‚                                                                 â”‚
â”‚  Consider:                                                      â”‚
â”‚  â€¢ Setting up a retention policy                               â”‚
â”‚  â€¢ Exporting and deleting old events                           â”‚
â”‚  â€¢ Expanding your storage allocation                           â”‚
â”‚                                                                 â”‚
â”‚                              [Manage Storage]  [Remind Later]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.6 API Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/storage/status` | Current usage, available space |
| GET | `/storage/retention` | Get retention policy |
| PUT | `/storage/retention` | Update retention policy |
| POST | `/storage/cleanup` | Trigger manual cleanup |
| POST | `/storage/vacuum` | Run SQLite VACUUM |
| GET | `/storage/integrity` | Run integrity check |
| GET | `/storage/deletion-requests` | List NIP-09 requests |
| POST | `/storage/deletion-requests/:id/honor` | Honor a request |

### 7.7 Data Model

```sql
-- Deletion request tracking
CREATE TABLE deletion_requests (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    event_id TEXT NOT NULL,           -- The kind 5 event ID
    author_pubkey TEXT NOT NULL,
    target_event_ids TEXT NOT NULL,   -- JSON array of target IDs
    status TEXT DEFAULT 'pending',    -- pending, honored, rejected
    processed_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Retention policy config
-- Stored in app_state table:
-- retention_days: "90" (or "0" for forever)
-- retention_exceptions: '["kind:0", "kind:3", "pubkey:operator"]'
-- honor_nip09: "true"
```

---

## 8. Export & Backup

Download events from the relay for backup or migration.

### 10.1 User Stories

- **As a user**, I want to download all my events as a backup
- **As a user**, I want to export only specific event types
- **As a user**, I want to export events from a specific date range
- **As a user**, I want to export in a format I can import elsewhere

### 8.2 Export Dialog

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Export Events                                             [âœ•] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  What to export:                                               â”‚
â”‚  â—‹ All events (12,847 events, ~45 MB)                         â”‚
â”‚  â— Selected event kinds                                        â”‚
â”‚                                                                 â”‚
â”‚     â˜‘ Notes (kind 1)           8,234 events                   â”‚
â”‚     â˜‘ Reactions (kind 7)       2,312 events                   â”‚
â”‚     â˜‘ Follow lists (kind 3)       47 events                   â”‚
â”‚     â˜ DMs (kind 4, 14)           892 events                   â”‚
â”‚     â˜‘ Profile (kind 0)            12 events                   â”‚
â”‚     â˜ Other kinds                 350 events                   â”‚
â”‚                                                                 â”‚
â”‚  Date range:                                                   â”‚
â”‚  â—‹ All time                                                    â”‚
â”‚  â— Custom range                                                â”‚
â”‚     From: [2025-01-01  ]  To: [2025-12-13  ]                  â”‚
â”‚                                                                 â”‚
â”‚  Format:                                                       â”‚
â”‚  â— NDJSON (Newline Delimited JSON) - recommended              â”‚
â”‚  â—‹ JSON Array                                                  â”‚
â”‚                                                                 â”‚
â”‚  Estimated size: ~38 MB                                        â”‚
â”‚                                                                 â”‚
â”‚                                    [Cancel]  [Export & Download]â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.3 Export Formats

**NDJSON (Recommended)**
```
{"id":"abc...","pubkey":"xyz...","created_at":1702489455,"kind":1,"tags":[],"content":"Hello","sig":"..."}
{"id":"def...","pubkey":"xyz...","created_at":1702489500,"kind":1,"tags":[],"content":"World","sig":"..."}
```

**JSON Array**
```json
[
  {"id":"abc...","pubkey":"xyz...","created_at":1702489455,"kind":1,"tags":[],"content":"Hello","sig":"..."},
  {"id":"def...","pubkey":"xyz...","created_at":1702489500,"kind":1,"tags":[],"content":"World","sig":"..."}
]
```

### 8.4 Export Flow

1. User selects export options
2. API streams events from database with filters
3. Events converted to selected format
4. Response streamed to browser as download
5. File named: `nostr-backup-{date}.ndjson` or `.json`

### 8.5 Large Export Handling

For exports > 100MB:
- Show progress indicator
- Use streaming response
- Consider chunked downloads or background job with notification

---

## 9. Support & Donations

Allow users to support the developer.

### 11.1 User Stories

- **As a user**, I want to tip the developer for their work
- **As a user**, I want to see how to get help if I have issues
- **As a user**, I want to contribute with one click if I have a Lightning wallet

### 9.2 Support Page Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Support Roostr                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚         âš¡ Support Development âš¡                            â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  Roostr is free and open source. If you find it useful,    â”‚   â”‚
â”‚  â”‚  consider supporting development!                           â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  LIGHTNING                â”‚ â”‚  BITCOIN                      â”‚   â”‚
â”‚  â”‚                           â”‚ â”‚                               â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚                     â”‚ â”‚ â”‚  â”‚                         â”‚ â”‚   â”‚
â”‚  â”‚  â”‚     [QR CODE]       â”‚ â”‚ â”‚  â”‚       [QR CODE]         â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                     â”‚ â”‚ â”‚  â”‚                         â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                           â”‚ â”‚                               â”‚   â”‚
â”‚  â”‚  you@getalby.com         â”‚ â”‚  bc1q...                      â”‚   â”‚
â”‚  â”‚  [Copy]                   â”‚ â”‚  [Copy]                       â”‚   â”‚
â”‚  â”‚                           â”‚ â”‚                               â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚                               â”‚   â”‚
â”‚  â”‚  â”‚  âš¡ Tip with WebLN  â”‚ â”‚ â”‚                               â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚                               â”‚   â”‚
â”‚  â”‚                           â”‚ â”‚                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  GET HELP                                                    â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  ğŸ“– Documentation    github.com/username/roostr/wiki        â”‚   â”‚
â”‚  â”‚  ğŸ› Report Issues    github.com/username/roostr/issues      â”‚   â”‚
â”‚  â”‚  ğŸ’¬ Discussion       github.com/username/roostr/discussions â”‚   â”‚
â”‚  â”‚  ğŸ˜ Follow on Nostr  npub1developer...                      â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ABOUT                                                       â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  ğŸ“ Roostr v1.0.0                                           â”‚   â”‚
â”‚  â”‚  "Your private roost on Nostr"                              â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  Built with â¤ï¸ using Svelte, Go, and nostr-rs-relay         â”‚   â”‚
â”‚  â”‚  License: MIT                                                â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.3 WebLN Integration

```javascript
// Check for WebLN provider (Alby, etc.)
if (window.webln) {
  try {
    await window.webln.enable();
    // Show "Tip with WebLN" button
  } catch (e) {
    // User denied or no provider
  }
}

// On tip button click:
async function tipDeveloper(amountSats = 1000) {
  const invoice = await fetch('/api/invoice?amount=' + amountSats);
  // Or use keysend/LNURL-pay
  await window.webln.sendPayment(invoice);
  showThankYou();
}
```

### 9.4 Donation Addresses (Configurable)

These will be configurable in the app's environment or build config:

```env
DONATION_LIGHTNING_ADDRESS=you@getalby.com
DONATION_BITCOIN_ADDRESS=bc1q...
DEVELOPER_NPUB=npub1...
GITHUB_REPO=https://github.com/username/roostr
```

---

## 10. Sync from Public Relays

Import your existing Nostr history from public relays into your private Roostr instance.

### 10.1 User Stories

- **As a user**, I want to import my existing posts from public relays so my private relay has my full history
- **As a user**, I want to see progress while syncing so I know it's working
- **As a user**, I want to choose which relays to sync from
- **As a user**, I want to sync events for specific pubkeys (myself and whitelisted users)

### 10.2 Sync Dialog

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Sync from Public Relays                                   [âœ•] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Import your Nostr history from public relays into Roostr.     â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  PUBKEYS TO SYNC                                        â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  â˜‘ Me (npub1abc...)                                     â”‚   â”‚
â”‚  â”‚  â˜‘ Wife (npub1def...)                                   â”‚   â”‚
â”‚  â”‚  â˜‘ alice@nostr.me (npub1ghi...)                         â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  [+ Add another pubkey]                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  SOURCE RELAYS                                          â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  â˜‘ wss://relay.damus.io                                 â”‚   â”‚
â”‚  â”‚  â˜‘ wss://relay.nostr.band                               â”‚   â”‚
â”‚  â”‚  â˜‘ wss://nos.lol                                        â”‚   â”‚
â”‚  â”‚  â˜‘ wss://relay.primal.net                               â”‚   â”‚
â”‚  â”‚  â˜ wss://nostr.wine                                     â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  [+ Add custom relay]                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  Event types to sync:                                          â”‚
â”‚  â˜‘ Posts  â˜‘ Reactions  â˜‘ Reposts  â˜‘ Profile  â˜‘ Follows       â”‚
â”‚  â˜ DMs (already encrypted, safe to sync)                       â”‚
â”‚                                                                 â”‚
â”‚                                         [Cancel] [Start Sync]  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.3 Sync Progress View

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Syncing...                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  67%                           â”‚
â”‚                                                                 â”‚
â”‚  Fetched: 2,847 events                                         â”‚
â”‚  New events saved: 1,203                                        â”‚
â”‚  Duplicates skipped: 1,644                                      â”‚
â”‚                                                                 â”‚
â”‚  Currently syncing: wss://relay.damus.io                       â”‚
â”‚  â”œâ”€ npub1abc... (me): 892 events âœ“                             â”‚
â”‚  â”œâ”€ npub1def... (wife): 311 events âœ“                           â”‚
â”‚  â””â”€ npub1ghi... (alice): fetching...                           â”‚
â”‚                                                                 â”‚
â”‚  â“˜ This may take a few minutes depending on history size       â”‚
â”‚                                                                 â”‚
â”‚                                              [Cancel] [Background]â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.4 Sync Complete

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Sync Complete! âœ“                                          [âœ•] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Successfully imported your Nostr history.                     â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  SUMMARY                                                 â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Total events fetched:     4,281                        â”‚   â”‚
â”‚  â”‚  New events saved:         2,847                        â”‚   â”‚
â”‚  â”‚  Already existed:          1,434                        â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  By type:                                                â”‚   â”‚
â”‚  â”‚    Posts:       1,892                                   â”‚   â”‚
â”‚  â”‚    Reactions:   847                                     â”‚   â”‚
â”‚  â”‚    Reposts:     52                                      â”‚   â”‚
â”‚  â”‚    Profile:     3                                       â”‚   â”‚
â”‚  â”‚    Follows:     53                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  Your relay now has a complete backup of your Nostr activity!  â”‚
â”‚                                                                 â”‚
â”‚                                                         [Done] â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.5 Technical Implementation

**Sync Flow:**
1. User selects pubkeys to sync (defaults to whitelisted pubkeys)
2. User selects source relays (defaults to popular public relays)
3. For each pubkey, for each relay:
   - Open WebSocket connection
   - Send REQ with filter: `{"authors": ["<pubkey>"], "kinds": [0,1,3,6,7,...]}`
   - Receive events until EOSE (End of Stored Events)
   - Write new events to local relay database (skip duplicates by event ID)
4. Show progress in real-time
5. Display summary on completion

**Default Source Relays:**
```go
var DefaultSyncRelays = []string{
    "wss://relay.damus.io",
    "wss://relay.nostr.band", 
    "wss://nos.lol",
    "wss://relay.primal.net",
    "wss://nostr.wine",
    "wss://relay.snort.social",
}
```

**API Endpoints:**

| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/sync/start` | Start sync job with config |
| GET | `/sync/status` | Get current sync progress |
| POST | `/sync/cancel` | Cancel running sync |
| GET | `/sync/history` | Past sync operations |

**Background Processing:**
- Sync runs as background job
- Progress updates via WebSocket or polling
- Can be sent to background while user does other things
- Stores last sync time per pubkey/relay for incremental syncs

### 10.6 Dashboard Integration

Add sync button to dashboard header (globe icon like current Umbrel app) and show last sync time:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Roostr                           [ğŸ”„ Sync] [âš™ Settings] [â¤ Support] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Last synced: 2 hours ago                      [Sync Now]      â”‚
```

---

## 11. Paid Relay Access

Monetize your relay by offering paid access to friends, family, and the broader Nostr community. Uses your own Lightning node for true self-sovereignty.

### 11.1 User Stories

- **As a relay operator**, I want to charge sats for relay access so I can offset hosting costs
- **As a relay operator**, I want to use my own Lightning node so I don't depend on custodians
- **As a relay operator**, I want to offer different payment tiers (lifetime, monthly, etc.)
- **As a relay operator**, I want to see how much revenue my relay has generated
- **As a paying user**, I want to easily pay and get access without manual intervention
- **As a paying user**, I want to pay via QR code, WebLN, or direct Lightning payment

### 11.2 Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PAID ACCESS FLOW                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Visitor    â”‚    â”‚   Roostr     â”‚    â”‚   Lightning Node     â”‚  â”‚
â”‚  â”‚  (wants      â”‚â”€â”€â”€â–¶â”‚   Backend    â”‚â”€â”€â”€â–¶â”‚   (LND / CLN)        â”‚  â”‚
â”‚  â”‚   access)    â”‚    â”‚              â”‚    â”‚   on Umbrel/Start9   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                   â”‚                      â”‚               â”‚
â”‚         â”‚                   â”‚                      â”‚               â”‚
â”‚    1. Enter npub      2. Generate           3. Create invoice      â”‚
â”‚                          invoice                                    â”‚
â”‚         â”‚                   â”‚                      â”‚               â”‚
â”‚         â–¼                   â–¼                      â–¼               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                     4. Pay Invoice                            â”‚  â”‚
â”‚  â”‚                        (QR / WebLN)                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                                      â”‚
â”‚                              â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Payment    â”‚    â”‚   Roostr     â”‚    â”‚   nostr-rs-relay     â”‚  â”‚
â”‚  â”‚   Confirmed  â”‚â”€â”€â”€â–¶â”‚   adds to    â”‚â”€â”€â”€â–¶â”‚   config.toml        â”‚  â”‚
â”‚  â”‚              â”‚    â”‚   whitelist  â”‚    â”‚   pubkey_whitelist   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                     â”‚
â”‚  5. User adds relay URL to their Nostr client                      â”‚
â”‚  6. NIP-42 authenticates user on connect                           â”‚
â”‚  7. Events accepted âœ“                                              â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 11.3 Access Modes

The existing whitelist feature expands to support three tiers:

| Mode | Description | Config |
|------|-------------|--------|
| **Private** | Only manually whitelisted pubkeys (default) | `access_mode = "private"` |
| **Paid** | Whitelist + anyone who pays | `access_mode = "paid"` |
| **Public** | Anyone can write (not recommended) | `access_mode = "public"` |

### 11.4 Payment Tiers

| Tier | Description | Implementation |
|------|-------------|----------------|
| **Lifetime** | Pay once, access forever | `expires_at = NULL` |
| **Monthly** | Pay monthly, auto-expires | `expires_at = payment_date + 30 days` |
| **Quarterly** | Pay every 3 months | `expires_at = payment_date + 90 days` |
| **Annual** | Pay yearly | `expires_at = payment_date + 365 days` |

Relay operator configures which tiers to offer and pricing for each.

### 11.5 Access Management UI

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Access Management                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ACCESS MODE                                                 â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  â—‹ Private (whitelist only)                                 â”‚   â”‚
â”‚  â”‚  â— Paid Access (whitelist + paid users)              [ACTIVE]â”‚   â”‚
â”‚  â”‚  â—‹ Public (anyone can write - not recommended)              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  PRICING                                                     â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  â˜‘ Lifetime Access     [10000   ] sats                      â”‚   â”‚
â”‚  â”‚  â˜‘ Monthly             [1000    ] sats/month                â”‚   â”‚
â”‚  â”‚  â˜ Quarterly           [2500    ] sats/quarter              â”‚   â”‚
â”‚  â”‚  â˜ Annual              [8000    ] sats/year                 â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  â“˜ Uncheck tiers you don't want to offer                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  LIGHTNING NODE                                              â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  Connection: [LND (REST API)  â–¼]                            â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  Host:       [umbrel.local:8080    ]  (auto-detected)       â”‚   â”‚
â”‚  â”‚  Macaroon:   [â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢]  [Browse] [Test]        â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  Status: â— Connected (balance: 245,000 sats)                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  PUBLIC SIGNUP PAGE                                          â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  Enable public signups: [âœ“]                                 â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  Signup URL (share this):                                   â”‚   â”‚
â”‚  â”‚  http://umbrel.local:3000/signup              [Copy] [QR]   â”‚   â”‚
â”‚  â”‚  http://abc123...onion:3000/signup            [Copy] [QR]   â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  Relay description for signup page:                         â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ Ryan's private Nostr relay. Fast, reliable, and       â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ censorship-resistant. Supporting a fellow Nostr pleb! â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 11.6 Paid Users Management

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Paid Users (12)                                     [Export CSV]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  REVENUE SUMMARY                                             â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  Total Revenue:     125,000 sats  (~$50)                    â”‚   â”‚
â”‚  â”‚  Active Subscribers: 12                                      â”‚   â”‚
â”‚  â”‚  Expiring Soon:      2 (within 7 days)                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  Filter: [All Users â–¼]  [All Tiers â–¼]  Search: [          ]       â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ‘¤ npub1abc...xyz                                           â”‚   â”‚
â”‚  â”‚    @alice (resolved via NIP-05)                             â”‚   â”‚
â”‚  â”‚    Tier: Lifetime    Paid: 10,000 sats    Date: Dec 10      â”‚   â”‚
â”‚  â”‚    Expires: Never                                            â”‚   â”‚
â”‚  â”‚    Events stored: 2,847                      [Revoke Access] â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ‘¤ npub1def...uvw                                           â”‚   â”‚
â”‚  â”‚    Tier: Monthly     Paid: 1,000 sats     Date: Dec 1       â”‚   â”‚
â”‚  â”‚    Expires: Dec 31, 2025  âš ï¸ 18 days                        â”‚   â”‚
â”‚  â”‚    Events stored: 423                        [Revoke Access] â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ‘¤ npub1ghi...rst                                           â”‚   â”‚
â”‚  â”‚    Tier: Monthly     Paid: 1,000 sats     Date: Dec 8       â”‚   â”‚
â”‚  â”‚    Expires: Jan 7, 2026  âš ï¸ EXPIRING SOON (5 days)          â”‚   â”‚
â”‚  â”‚    Events stored: 156                        [Revoke Access] â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  ... more users ...                                                â”‚
â”‚                                                                     â”‚
â”‚  [â† Prev]  Page 1 of 2  [Next â†’]                                   â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 11.7 Public Signup Page

A simple, public-facing page accessible via local network or Tor:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                     â”‚
â”‚                         ğŸ“ Ryan's Roostr                            â”‚
â”‚                       Private Nostr Relay                          â”‚
â”‚                                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  Get reliable backup relay access for your Nostr activity.         â”‚
â”‚                                                                     â”‚
â”‚  âœ“ Always online, always syncing                                   â”‚
â”‚  âœ“ Private & censorship-resistant                                  â”‚
â”‚  âœ“ Tor accessible from anywhere                                    â”‚
â”‚  âœ“ Support a fellow Nostr pleb                                     â”‚
â”‚                                                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                     â”‚
â”‚  SELECT A PLAN                                                      â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚  âš¡ LIFETIME        â”‚  â”‚  ğŸ“… MONTHLY         â”‚                  â”‚
â”‚  â”‚                     â”‚  â”‚                     â”‚                  â”‚
â”‚  â”‚   10,000 sats       â”‚  â”‚   1,000 sats/mo     â”‚                  â”‚
â”‚  â”‚   (~$4)             â”‚  â”‚   (~$0.40)          â”‚                  â”‚
â”‚  â”‚                     â”‚  â”‚                     â”‚                  â”‚
â”‚  â”‚  Pay once, access   â”‚  â”‚  Auto-expires       â”‚                  â”‚
â”‚  â”‚  forever            â”‚  â”‚  after 30 days      â”‚                  â”‚
â”‚  â”‚                     â”‚  â”‚                     â”‚                  â”‚
â”‚  â”‚  [ SELECT ]         â”‚  â”‚  [ SELECT ]         â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                     â”‚
â”‚  YOUR NOSTR IDENTITY                                                â”‚
â”‚                                                                     â”‚
â”‚  Enter your npub or NIP-05:                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ npub1... or alice@nostr.me                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  âœ“ Valid pubkey detected                                           â”‚
â”‚                                                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                     â”‚
â”‚  PAY WITH LIGHTNING                                                 â”‚
â”‚                                                                     â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚           â”‚                                     â”‚                  â”‚
â”‚           â”‚           â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„           â”‚                  â”‚
â”‚           â”‚           â–ˆ QR CODE    â–ˆ           â”‚                  â”‚
â”‚           â”‚           â–ˆ lnbc100u.. â–ˆ           â”‚                  â”‚
â”‚           â”‚           â–ˆ            â–ˆ           â”‚                  â”‚
â”‚           â”‚           â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€â–€           â”‚                  â”‚
â”‚           â”‚                                     â”‚                  â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                     â”‚
â”‚           lnbc100u1pjxxx...                          [Copy]        â”‚
â”‚                                                                     â”‚
â”‚                    [ âš¡ Pay with WebLN ]                            â”‚
â”‚                                                                     â”‚
â”‚           Invoice expires in: 14:32                                â”‚
â”‚                                                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                     â”‚
â”‚  After payment confirmation, add this relay to your client:        â”‚
â”‚                                                                     â”‚
â”‚  wss://abc123...onion:4848                          [Copy]         â”‚
â”‚                                                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                     â”‚
â”‚  Questions? Contact the operator on Nostr:                         â”‚
â”‚  npub1operator...                                                  â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 11.8 Lightning Node Integration (LND/CLN)

#### Platform Detection

| Platform | Node Type | Connection Method |
|----------|-----------|-------------------|
| Umbrel | LND | REST API via `umbrel.local:8080` |
| Umbrel | CLN (if installed) | REST API or gRPC |
| Start9 | LND | REST API via service discovery |
| Start9 | CLN | REST API via c-lightning-REST |

#### LND Integration (Primary)

```go
type LNDConfig struct {
    Host        string // e.g., "umbrel.local:8080"
    MacaroonHex string // admin.macaroon as hex
    TLSCertPath string // optional, for non-Umbrel setups
}

type LightningService interface {
    // Generate invoice for a specific pubkey and tier
    CreateInvoice(pubkey string, tier string, amountSats int64) (*Invoice, error)
    
    // Check if invoice has been paid
    CheckInvoice(paymentHash string) (bool, error)
    
    // Subscribe to invoice updates (for real-time confirmation)
    SubscribeInvoices(ctx context.Context) (<-chan InvoiceUpdate, error)
    
    // Get node info (for connection status display)
    GetInfo() (*NodeInfo, error)
    
    // Get balance (for UI display)
    GetBalance() (int64, error)
}

type Invoice struct {
    PaymentRequest string    // The BOLT11 invoice string
    PaymentHash    string    // For tracking payment
    AmountSats     int64
    ExpiresAt      time.Time
    Memo           string    // e.g., "Roostr access: lifetime"
}
```

#### Auto-Detection on Umbrel

```go
func DetectUmbrelLND() (*LNDConfig, error) {
    // Umbrel exposes LND credentials via environment or known paths
    
    // Check for Umbrel's LND
    macaroonPath := "/umbrel/lnd/data/chain/bitcoin/mainnet/admin.macaroon"
    if _, err := os.Stat(macaroonPath); err == nil {
        macaroon, _ := os.ReadFile(macaroonPath)
        return &LNDConfig{
            Host:        "umbrel.local:8080", // or 10.21.21.9:8080
            MacaroonHex: hex.EncodeToString(macaroon),
        }, nil
    }
    
    // Check environment variables
    if host := os.Getenv("LND_REST_HOST"); host != "" {
        return &LNDConfig{
            Host:        host,
            MacaroonHex: os.Getenv("LND_MACAROON_HEX"),
        }, nil
    }
    
    return nil, errors.New("LND not detected")
}
```

#### Invoice Flow

```
1. User selects tier, enters pubkey
2. Backend calls LND: lnrpc.AddInvoice({
     value: 10000,
     memo: "Roostr lifetime access for npub1abc...",
     expiry: 900 // 15 minutes
   })
3. Return payment_request (BOLT11) to frontend
4. Frontend displays QR code + invoice string
5. Backend subscribes to invoice updates OR polls
6. On payment confirmed:
   - Add pubkey to paid_users table
   - Add pubkey to relay whitelist (config.toml)
   - Reload relay config
   - Show success message to user
```

### 11.9 NIP-42 Authentication

nostr-rs-relay already supports NIP-42. Enable it to verify paid users:

```toml
# config.toml
[authorization]
nip42_auth = true           # Require authentication
nip42_dms = true            # Require auth for DMs specifically

pubkey_whitelist = [
  "hexkey1",  # Manual whitelist (family)
  "hexkey2",  # Paid user
  "hexkey3",  # Paid user
]
```

**NIP-42 Flow:**
```
Client connects via WebSocket
    â†“
Relay sends: ["AUTH", "<challenge>"]
    â†“
Client signs challenge with private key
    â†“
Client sends: ["AUTH", <signed-event>]
    â†“
Relay verifies signature, checks if pubkey in whitelist
    â†“
If valid: Accept events | If invalid: Reject with "restricted"
```

### 11.10 Subscription Expiry

Background job to handle expiring subscriptions:

```go
// Run daily via cron or ticker
func ProcessExpiredSubscriptions() {
    expired := db.Query(`
        SELECT pubkey FROM paid_users 
        WHERE expires_at IS NOT NULL 
        AND expires_at < NOW()
    `)
    
    for _, pubkey := range expired {
        // Remove from relay whitelist
        config.RemoveFromWhitelist(pubkey)
        
        // Mark as expired in our DB (don't delete - keep history)
        db.Exec(`UPDATE paid_users SET status = 'expired' WHERE pubkey = ?`, pubkey)
        
        // Optional: Send expiry notification via Nostr DM
        // notifyExpiry(pubkey)
    }
    
    // Reload relay config
    relay.ReloadConfig()
}
```

### 11.11 Data Model

```sql
-- Paid users table
CREATE TABLE paid_users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    pubkey TEXT NOT NULL UNIQUE,       -- hex format
    npub TEXT NOT NULL,                 -- bech32 for display
    tier TEXT NOT NULL,                 -- 'lifetime', 'monthly', 'quarterly', 'annual'
    amount_sats INTEGER NOT NULL,       -- amount paid
    payment_hash TEXT NOT NULL,         -- LN invoice payment hash
    paid_at TIMESTAMP NOT NULL,
    expires_at TIMESTAMP,               -- NULL for lifetime
    status TEXT DEFAULT 'active',       -- 'active', 'expired', 'revoked'
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Payment history (for revenue tracking)
CREATE TABLE payments (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    pubkey TEXT NOT NULL,
    amount_sats INTEGER NOT NULL,
    payment_hash TEXT NOT NULL,
    tier TEXT NOT NULL,
    paid_at TIMESTAMP NOT NULL,
    FOREIGN KEY (pubkey) REFERENCES paid_users(pubkey)
);

-- Indexes
CREATE INDEX idx_paid_users_status ON paid_users(status);
CREATE INDEX idx_paid_users_expires ON paid_users(expires_at);
```

### 11.12 API Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/access/mode` | Get current access mode |
| PUT | `/access/mode` | Set access mode (private/paid/public) |
| GET | `/access/pricing` | Get pricing tiers |
| PUT | `/access/pricing` | Update pricing tiers |
| GET | `/access/paid-users` | List paid users |
| DELETE | `/access/paid-users/:pubkey` | Revoke access |
| GET | `/access/revenue` | Get revenue summary |
| GET | `/lightning/status` | Check LN node connection |
| PUT | `/lightning/config` | Update LN node config |
| POST | `/signup/invoice` | Generate invoice for signup |
| GET | `/signup/invoice/:hash` | Check invoice status |

### 11.13 Public API (Signup Page)

These endpoints are publicly accessible (no auth):

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/public/relay-info` | Get relay name, description, pricing |
| POST | `/public/create-invoice` | Create invoice for pubkey + tier |
| GET | `/public/invoice-status/:hash` | Poll for payment confirmation |

---

## 12. Tor & Network Infrastructure

Both Umbrel and Start9 provide built-in Tor support, enabling secure remote access to your relay without exposing your home IP address or requiring port forwarding.

### 12.1 How Tor Works on Each Platform

#### Umbrel
- Umbrel runs a Tor daemon that automatically creates `.onion` hidden services for apps
- Each app gets a unique .onion address stored in `~/umbrel/tor/data/app-{app-id}/hostname`
- The `TOR_ADDRESS` environment variable is injected into containers
- Users access via `ws://{onion}.onion:4848` (WebSocket over Tor)

#### Start9 (StartOS)
- StartOS manages Tor services through its packaging system
- `.onion` addresses are configured in the app's `manifest.yaml`
- The address is exposed via environment variables and the properties API
- Same WebSocket format: `ws://{onion}.onion:4848`

### 12.2 Roostr Tor Implementation

**Detection:**
```go
func GetTorAddress() string {
    // Check environment variable first (works on both platforms)
    if addr := os.Getenv("TOR_ADDRESS"); addr != "" {
        return addr
    }
    
    // Umbrel fallback: read from hostname file
    if data, err := os.ReadFile("/umbrel/tor/hostname"); err == nil {
        return strings.TrimSpace(string(data))
    }
    
    return "" // Tor not available
}
```

**API Response:**
```json
{
  "relay_status": "online",
  "urls": {
    "local": "ws://192.168.1.100:4848",
    "tor": "ws://abc123xyz...onion:4848",
    "tor_available": true
  }
}
```

**UI Behavior:**
- If `tor_available` is true, show both Local and Tor URLs
- If false, only show Local URL (no Tor section)
- Tor QR codes should be clearly labeled for mobile wallet scanning

### 12.3 Remote Access Tips (For Users)

The dashboard should include helpful tips for remote access:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ’¡ REMOTE ACCESS TIPS                                          â”‚
â”‚                                                                 â”‚
â”‚  To connect to your relay from anywhere:                       â”‚
â”‚                                                                 â”‚
â”‚  â€¢ Use your Tor URL in Nostr clients that support Tor          â”‚
â”‚    (Damus, Amethyst, etc.)                                     â”‚
â”‚                                                                 â”‚
â”‚  â€¢ For faster connections, install Tailscale on your Umbrel    â”‚
â”‚    and devices, then use: ws://umbrel:4848                     â”‚
â”‚                                                                 â”‚
â”‚  â€¢ Never share your Tor URL publicly - it's your private       â”‚
â”‚    relay address!                                              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 12.4 Platform-Specific Configuration

#### Umbrel docker-compose.yml
```yaml
services:
  relay:
    image: scsibug/nostr-rs-relay:latest
    environment:
      - TOR_ADDRESS=${APP_HIDDEN_SERVICE}
    # Umbrel injects APP_HIDDEN_SERVICE automatically
```

#### Start9 manifest.yaml
```yaml
interfaces:
  relay:
    name: Nostr Relay
    description: WebSocket relay interface
    tor-config:
      port-mapping:
        4848: 4848
    lan-config:
      443:
        ssl: true
        internal: 4848
```

---

## 13. Platform Integration

How Roostr integrates with Umbrel and Start9 platforms for authentication, health checks, and relay control.

### 13.1 App Authentication

Users need to authenticate to access the Roostr admin interface. Both platforms provide built-in mechanisms.

#### Umbrel Authentication

Umbrel uses `app_proxy` which automatically handles authentication:

```yaml
# docker-compose.yml
services:
  web:
    environment:
      - APP_PASSWORD=${APP_PASSWORD}  # Umbrel injects this
```

- Users log in once to Umbrel dashboard
- `app_proxy` passes auth headers to app
- Roostr trusts requests that pass through Umbrel's proxy
- No additional login required

#### Start9 Authentication

StartOS handles authentication at the OS level:

```yaml
# manifest.yaml
interfaces:
  main:
    tor-config:
      port-mapping:
        80: 3000
    ui: true
    protocols:
      - tcp
      - http
```

- Users authenticate via StartOS interface
- Session managed by StartOS
- App receives authenticated requests

#### Direct Access (Development)

For local development without platform:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Roostr Login                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  This Roostr instance is running outside Umbrel/Start9.        â”‚
â”‚                                                                 â”‚
â”‚  Password:                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢                                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â“˜ Default password is in your docker-compose.yml              â”‚
â”‚                                                                 â”‚
â”‚                                              [ Login ]         â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 13.2 Health Checks

Both platforms monitor app health. Roostr must provide health endpoints.

#### Health Check Endpoint

```
GET /health

Response (healthy):
{
  "status": "healthy",
  "relay": "running",
  "database": "connected",
  "uptime_seconds": 86400,
  "version": "1.0.0"
}

Response (unhealthy):
{
  "status": "unhealthy",
  "relay": "stopped",
  "database": "connected",
  "error": "Relay process not responding",
  "version": "1.0.0"
}
```

#### Umbrel Health Check

```yaml
# docker-compose.yml
services:
  web:
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
```

#### Start9 Health Check

```typescript
// scripts/health.ts
import { types as T, healthUtil } from "../deps.ts";

export const health: T.ExpectedExports.health = async (effects) => {
  try {
    const response = await fetch("http://localhost:3000/health");
    const data = await response.json();
    
    if (data.status === "healthy") {
      return healthUtil.checkWebUrl("http://localhost:3000")
    }
    return { status: "failing", message: data.error };
  } catch (e) {
    return { status: "failing", message: e.message };
  }
};
```

### 13.3 Relay Controls

Operators need to control the relay process (restart, reload config).

#### Control Actions

| Action | Description | Method |
|--------|-------------|--------|
| **Status** | Check if relay is running | Check process, return status |
| **Reload** | Reload config without restart | Send SIGHUP to relay process |
| **Restart** | Full relay restart | Stop and start relay process |
| **Stop** | Stop relay (careful!) | Stop relay process |

#### Relay Control UI

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Relay Control                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  RELAY STATUS                                                â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  Status:  â— Running                                         â”‚   â”‚
â”‚  â”‚  PID:     1234                                              â”‚   â”‚
â”‚  â”‚  Uptime:  14d 6h 23m                                        â”‚   â”‚
â”‚  â”‚  Memory:  45 MB                                             â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  [Reload Config]  [Restart Relay]                           â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  â“˜ Reload applies config changes without dropping           â”‚   â”‚
â”‚  â”‚    connections. Restart briefly disconnects all clients.    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  RECENT RELAY LOGS                                          â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  [2025-12-13 14:32:01] INFO  New connection from 10.0.0.5  â”‚   â”‚
â”‚  â”‚  [2025-12-13 14:32:00] INFO  Event stored: note1abc...     â”‚   â”‚
â”‚  â”‚  [2025-12-13 14:31:58] INFO  Subscription created          â”‚   â”‚
â”‚  â”‚  [2025-12-13 14:31:45] INFO  Config reloaded               â”‚   â”‚
â”‚  â”‚  [2025-12-13 14:30:00] INFO  Relay started on :4848        â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚                                              [View Full Log] â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Implementation

```go
type RelayController struct {
    relayPID    int
    relayCmd    *exec.Cmd
    configPath  string
}

func (rc *RelayController) Status() RelayStatus {
    // Check if process is running
    process, err := os.FindProcess(rc.relayPID)
    if err != nil {
        return RelayStatus{Running: false}
    }
    // ... get memory, uptime
}

func (rc *RelayController) Reload() error {
    // Send SIGHUP to reload config
    process, _ := os.FindProcess(rc.relayPID)
    return process.Signal(syscall.SIGHUP)
}

func (rc *RelayController) Restart() error {
    // Stop current process
    rc.relayCmd.Process.Signal(syscall.SIGTERM)
    rc.relayCmd.Wait()
    
    // Start new process
    rc.relayCmd = exec.Command("nostr-rs-relay", "--config", rc.configPath)
    return rc.relayCmd.Start()
}
```

### 13.4 Log Access

View relay logs from the UI:

```go
func GetRelayLogs(lines int) []LogEntry {
    // Read from relay's stdout/stderr or log file
    // Parse timestamps, levels, messages
    // Return most recent N lines
}
```

#### Log Streaming (WebSocket)

For real-time log viewing:

```
WS /api/v1/logs/stream

Client receives:
{"timestamp": "2025-12-13T14:32:01Z", "level": "INFO", "message": "New connection from 10.0.0.5"}
{"timestamp": "2025-12-13T14:32:00Z", "level": "INFO", "message": "Event stored: note1abc..."}
```

### 13.5 API Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/health` | Health check (public) |
| GET | `/relay/status` | Detailed relay status |
| POST | `/relay/reload` | Reload config (SIGHUP) |
| POST | `/relay/restart` | Restart relay |
| GET | `/relay/logs` | Get recent log entries |
| WS | `/relay/logs/stream` | Stream logs in real-time |

### 13.6 Platform-Specific Files

#### Umbrel Package Structure

```
roostr/
â”œâ”€â”€ docker-compose.yml      # Multi-container setup
â”œâ”€â”€ umbrel-app.yml         # App metadata
â”œâ”€â”€ exports.sh             # Environment exports
â””â”€â”€ data/                  # Persistent volume mount
```

#### Start9 Package Structure

```
roostr/
â”œâ”€â”€ Dockerfile             # Single multi-stage build
â”œâ”€â”€ manifest.yaml          # App metadata, interfaces, config
â”œâ”€â”€ instructions.md        # User-facing documentation
â”œâ”€â”€ icon.png
â”œâ”€â”€ LICENSE
â””â”€â”€ scripts/
    â”œâ”€â”€ procedures.ts      # Main script runner
    â”œâ”€â”€ getConfig.ts       # Config form definition
    â”œâ”€â”€ setConfig.ts       # Config application
    â”œâ”€â”€ health.ts          # Health check
    â”œâ”€â”€ migration.ts       # Version migration
    â””â”€â”€ deps.ts            # Dependencies
```

---

## 14. Global UI/UX Requirements

### 14.1 Design System

| Element | Specification |
|---------|---------------|
| **Primary Color** | Purple (#8B5CF6) - matches Nostr/Umbrel vibes |
| **Background** | Dark (#0F0F0F) |
| **Surface** | Slightly lighter (#1A1A1A) |
| **Text Primary** | White (#FFFFFF) |
| **Text Secondary** | Gray (#9CA3AF) |
| **Success** | Green (#10B981) |
| **Warning** | Yellow (#F59E0B) |
| **Error** | Red (#EF4444) |
| **Font** | Inter or system-ui |
| **Border Radius** | 8px for cards, 4px for buttons |

### 14.2 Navigation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“ Roostr                                          â”‚
â”‚                                                     â”‚
â”‚  Dashboard                                          â”‚
â”‚  Event Browser                                      â”‚
â”‚  Access Control                                     â”‚
â”‚  Statistics                                         â”‚
â”‚  Configuration                                      â”‚
â”‚  Export                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                  â”‚
â”‚  Support                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- Sidebar navigation on desktop (collapsible)
- Bottom navigation on mobile
- Current page highlighted
- Icons for each nav item

### 14.3 Responsive Breakpoints

| Breakpoint | Width | Layout |
|------------|-------|--------|
| Mobile | < 640px | Single column, bottom nav |
| Tablet | 640-1024px | Two columns where appropriate |
| Desktop | > 1024px | Full layout with sidebar |

### 14.4 Loading States

- Skeleton loaders for data that's loading
- Spinner for actions in progress
- Optimistic updates where appropriate

### 14.5 Error Handling

- Toast notifications for transient errors
- Inline error messages for form validation
- Full-page error state for critical failures
- Retry buttons where applicable

### 14.6 Accessibility

- Keyboard navigable
- Proper focus states
- ARIA labels on interactive elements
- Color contrast meets WCAG AA
- Screen reader friendly

---

## 15. API Specification

### 15.1 Base URL

```
/api/v1
```

### 15.2 Endpoints

#### Setup

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/setup/status` | Check if setup is complete |
| POST | `/setup/complete` | Submit setup wizard data |
| POST | `/setup/reset` | Reset app (requires confirmation) |

#### Dashboard & Stats

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/stats/summary` | Dashboard summary stats |
| GET | `/stats/events-over-time` | Time series data |
| GET | `/stats/events-by-kind` | Event distribution |
| GET | `/stats/top-authors` | Most active pubkeys |
| GET | `/relay/status` | Relay health/uptime |
| GET | `/relay/urls` | Get local and Tor URLs |

#### Events

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/events` | List events (with filters) |
| GET | `/events/:id` | Get single event |
| DELETE | `/events/:id` | Delete event |
| GET | `/events/export` | Stream events for export |

#### Access Control

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/access/mode` | Get current mode |
| PUT | `/access/mode` | Set mode (open/whitelist/blacklist) |
| GET | `/access/whitelist` | List whitelisted pubkeys |
| POST | `/access/whitelist` | Add to whitelist |
| DELETE | `/access/whitelist/:pubkey` | Remove from whitelist |
| GET | `/access/blacklist` | List blacklisted pubkeys |
| POST | `/access/blacklist` | Add to blacklist |
| DELETE | `/access/blacklist/:pubkey` | Remove from blacklist |

#### Configuration

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/config` | Get all config |
| PATCH | `/config` | Update config fields |
| POST | `/config/reload` | Signal relay to reload |

#### Storage

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/storage/status` | Current usage, available space |
| GET | `/storage/retention` | Get retention policy |
| PUT | `/storage/retention` | Update retention policy |
| POST | `/storage/cleanup` | Trigger manual cleanup |
| POST | `/storage/vacuum` | Run SQLite VACUUM |
| GET | `/storage/integrity` | Run integrity check |
| GET | `/storage/deletion-requests` | List NIP-09 requests |
| POST | `/storage/deletion-requests/:id/honor` | Honor a deletion request |

#### Relay Control

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/relay/status` | Detailed relay status |
| POST | `/relay/reload` | Reload config (SIGHUP) |
| POST | `/relay/restart` | Restart relay |
| GET | `/relay/logs` | Get recent log entries |
| WS | `/relay/logs/stream` | Stream logs in real-time |

#### Sync

| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/sync/start` | Start sync job |
| GET | `/sync/status` | Get sync progress |
| POST | `/sync/cancel` | Cancel running sync |
| GET | `/sync/history` | Past sync operations |

#### Paid Access

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/access/pricing` | Get pricing tiers |
| PUT | `/access/pricing` | Update pricing tiers |
| GET | `/access/paid-users` | List paid users |
| DELETE | `/access/paid-users/:pubkey` | Revoke paid access |
| GET | `/access/revenue` | Get revenue summary |

#### Lightning

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/lightning/status` | Check LN node connection |
| GET | `/lightning/balance` | Get node balance |
| PUT | `/lightning/config` | Update LN node config |

#### Public (No Auth Required)

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/public/relay-info` | Get relay name, description, pricing |
| POST | `/public/create-invoice` | Create invoice for pubkey + tier |
| GET | `/public/invoice-status/:hash` | Poll for payment confirmation |

#### Utilities

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/nip05/:identifier` | Resolve NIP-05 to pubkey |
| GET | `/profile/:pubkey` | Get profile metadata |

### 15.3 Example Requests/Responses

**GET /api/v1/relay/urls**
```json
{
  "local": "ws://192.168.1.100:4848",
  "tor": "ws://abc123xyzdef456...onion:4848",
  "tor_available": true
}
```

**GET /api/v1/stats/summary**
```json
{
  "total_events": 12847,
  "events_today": 142,
  "storage_bytes": 259000000,
  "whitelisted_count": 3,
  "events_by_kind": {
    "1": 8234,
    "3": 47,
    "7": 2312,
    "4": 892,
    "other": 1362
  },
  "uptime_seconds": 1234567,
  "relay_status": "online"
}
```

**GET /api/v1/events?kind=1&limit=50&offset=0**
```json
{
  "events": [
    {
      "id": "abc123...",
      "pubkey": "xyz789...",
      "created_at": 1702489455,
      "kind": 1,
      "tags": [],
      "content": "Hello world",
      "sig": "..."
    }
  ],
  "total": 8234,
  "limit": 50,
  "offset": 0
}
```

**POST /api/v1/access/whitelist**
```json
{
  "pubkey": "npub1abc...",
  "nickname": "My friend Alice"
}
```

Response:
```json
{
  "success": true,
  "pubkey": "abc123...",  // hex format stored
  "npub": "npub1abc...",
  "nickname": "My friend Alice"
}
```

---

## 16. Data Models

### 16.1 Database Schema (SQLite - nostr-rs-relay)

We **read from** nostr-rs-relay's existing schema:

```sql
-- Main events table (simplified)
CREATE TABLE event (
  id BLOB PRIMARY KEY,
  pubkey BLOB NOT NULL,
  created_at INTEGER NOT NULL,
  kind INTEGER NOT NULL,
  tags TEXT NOT NULL,  -- JSON array
  content TEXT NOT NULL,
  sig BLOB NOT NULL
);

CREATE INDEX event_pubkey ON event(pubkey);
CREATE INDEX event_kind ON event(kind);
CREATE INDEX event_created ON event(created_at);
```

### 16.2 Application Data (Separate SQLite or JSON)

For app-specific data not in relay DB:

```sql
-- Pubkey nicknames
CREATE TABLE pubkey_nicknames (
  pubkey TEXT PRIMARY KEY,
  nickname TEXT NOT NULL,
  added_at INTEGER NOT NULL
);

-- App settings (key-value)
CREATE TABLE app_settings (
  key TEXT PRIMARY KEY,
  value TEXT NOT NULL
);
```

Or simpler JSON file:
```json
{
  "nicknames": {
    "abc123...": "Alice",
    "def456...": "Bob"
  },
  "donation_lightning": "ryan@getalby.com",
  "donation_bitcoin": "bc1q..."
}
```

### 16.3 Config Model (config.toml)

```go
type Config struct {
    Info struct {
        RelayURL    string `toml:"relay_url"`
        Name        string `toml:"name"`
        Description string `toml:"description"`
        Contact     string `toml:"contact"`
        RelayIcon   string `toml:"relay_icon"`
    } `toml:"info"`
    
    Authorization struct {
        PubkeyWhitelist []string `toml:"pubkey_whitelist"`
        PubkeyBlacklist []string `toml:"pubkey_blacklist"`
        NIP42Auth       bool     `toml:"nip42_auth"`
    } `toml:"authorization"`
    
    Limits struct {
        MessagesPerSec    int `toml:"messages_per_sec"`
        MaxEventBytes     int `toml:"max_event_bytes"`
        MaxWSMessageBytes int `toml:"max_ws_message_bytes"`
        MaxSubsPerConn    int `toml:"max_subs_per_conn"`
        MinPOWDifficulty  int `toml:"min_pow_difficulty"`
    } `toml:"limits"`
}
```

---

## Summary Checklist

### MVP Features

- [ ] **First-Run Setup**: Wizard to configure relay name, operator pubkey, access mode
- [ ] **Dashboard**: Status, URLs (local + Tor), metrics, recent activity (clickable), quick actions, sync button
- [ ] **Statistics**: Time series, kind distribution, top authors, storage
- [ ] **Access Control**: Mode selection (private/paid/public), whitelist/blacklist CRUD, NIP-05 lookup
- [ ] **Event Browser**: Filtered list, detail view, delete capability, deep-linking from activity feed
- [ ] **Configuration**: NIP-11 fields, limits, policies
- [ ] **Storage Management**: Usage monitoring, retention policies, NIP-09 deletion requests, manual cleanup, DB maintenance
- [ ] **Export**: Selective export, date range, NDJSON/JSON formats
- [ ] **Support**: Lightning/Bitcoin addresses, WebLN, help links
- [ ] **Sync**: Import from public relays, progress tracking, pubkey selection
- [ ] **Paid Access**: LND/CLN integration, pricing tiers, public signup page, payment tracking, auto-expiry
- [ ] **Tor Support**: Auto-detect Tor URL from platform, display in UI with QR codes
- [ ] **Platform Integration**: Health checks, relay controls (restart/reload), log viewer, platform auth

### Technical Requirements

- [ ] Go API backend
- [ ] Svelte frontend with Tailwind
- [ ] SQLite read access (relay DB)
- [ ] SQLite for app data (users, settings, deletion requests)
- [ ] TOML config read/write
- [ ] WebSocket for real-time updates (activity, logs)
- [ ] Nostr client library for sync feature
- [ ] LND/CLN REST API integration for payments
- [ ] NIP-42 authentication enforcement
- [ ] NIP-09 deletion request handling
- [ ] Tor URL detection (Umbrel + Start9)
- [ ] Health check endpoint
- [ ] Process management (relay restart/reload)
- [ ] Responsive design
- [ ] Umbrel packaging (Docker Compose)
- [ ] Start9 packaging (.s9pk)

---

*Roostr - Your Private Roost on Nostr*

*This specification is a living document. Update as requirements evolve.*
